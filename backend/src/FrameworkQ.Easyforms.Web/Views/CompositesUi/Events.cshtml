@{
    Layout = "/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Composite - Events";
}

<div class="card">
    <h2>Composite - Events</h2>
    <form data-form="comp-events" data-title="Composite Events" data-version="1.0">
        <div data-composite-def="counter-block" hidden>
            <div data-runtime>
                <div class="counter" style="display:flex;align-items:center;gap:6px;">
                    <button type="button" class="btn-dec">-</button>
                    <input type="number" class="val" value="0" style="width:80px;">
                    <button type="button" class="btn-inc">+</button>
                </div>
            </div>
        </div>

        <section data-section id="sec" data-title="Counter Demo">
            <div>
                <div data-composite="counter-block" id="ctr1" data-events="click:.btn-inc=>counter.inc; click:.btn-dec=>counter.dec; ready=>counter.ready"></div>
            </div>
            <div style="margin-top:10px;" id="log"></div>
        </section>
    </form>
</div>

<script>
    $(function(){
        var rt = FormRuntimeHTMLDSL.mount('form[data-form]');
        var $form = rt.$form;
        function append(msg){ $('#log').append('<div>'+msg+'</div>'); }
        $form.on('formdsl:composite:counter.ready', function(e, payload){ append('Ready: '+ payload.widgetId); });
        $form.on('formdsl:composite:counter.inc', function(e, payload){ var $root = $('#'+payload.widgetId); var $val = $root.find('.val'); $val.val((parseInt($val.val()||'0',10)+1)); append('Increment'); });
        $form.on('formdsl:composite:counter.dec', function(e, payload){ var $root = $('#'+payload.widgetId); var $val = $root.find('.val'); $val.val((parseInt($val.val()||'0',10)-1)); append('Decrement'); });
    });
</script>

