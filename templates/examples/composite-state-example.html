<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Composite State Example</title>
  <link rel="stylesheet" href="../../frontend/src/css/forms.css">
</head>
<body>
  <form data-form="comp-state" data-title="Composite State" data-version="1.0">
    <div data-composite-def="note-editor" hidden>
      <div data-runtime>
        <div>
          <input type="text" placeholder="Title" data-state-key="title" style="width: 100%; margin-bottom:6px;" />
          <textarea placeholder="Note" rows="3" data-state-key="note" style="width:100%;"></textarea>
        </div>
      </div>
    </div>

    <section data-section id="sec" data-title="Editor">
      <div data-composite="note-editor" id="ed1"></div>
      <div style="margin-top:8px;">
        <button type="button" id="saveState">Save State</button>
        <button type="button" id="restoreState">Restore State</button>
      </div>
      <div style="margin-top:8px;">
        <label>State JSON</label>
        <textarea id="stateJson" rows="6" style="width:100%;"></textarea>
      </div>
    </section>
  </form>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="../../frontend/src/js/composites.js"></script>
  <script src="../../frontend/src/js/formruntime.js"></script>
  <script>
    $(function(){
      var rt = FormRuntimeHTMLDSL.mount('form[data-form]');
      $('#saveState').on('click', function(){
        var st = window.CompositeWidgets.getState(rt.$form);
        $('#stateJson').val(JSON.stringify(st, null, 2));
      });
      $('#restoreState').on('click', function(){
        try { var obj = JSON.parse($('#stateJson').val()||'{}'); window.CompositeWidgets.setState(rt.$form, obj); } catch(e){ alert('Invalid JSON'); }
      });
    });
  </script>
</body>
</html>

